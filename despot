#!/bin/sh

DESPOT_VERSION="trunk:2022-07-11"

die() {
  case "$1" in
    1) echo "error: package not installed"; exit ;;
    2) echo "error: missing dependency $2"; exit ;;
    3) echo "error: no argument given"; exit ;;
    99) exit ;;
  esac
}

PKG_NAME="$2"
test $1 && PKG_LOCK="$1" && . db/repo/$PKG_NAME.dbuild || PKG_LOCK="help"
case "$PKG_LOCK" in
  "install") echo "$DEB_DEPENDENCIES" | xargs apt-get install -y || \
	     echo "$RPM_DEPENDENCIES" | xargs dnf install -y; \
	     package_install ;;
  "uninstall") package_uninstall ;;
  "version" | "v") echo "despot ${DESPOT_VERSION}"; die 99 ;;
  "help" | "h") cat << EOF
./despot [cmd]

commands:
help            | you're here now
install [pkg]   | install a package
uninstall [pkg] | uninstall a package
version         | show current version
EOF
  die 99 ;;
esac

unset PKG_TITLE PKG_AUTHOR PKG_VERSION package_remove sources_verify package_install
cd ../../..
rm -rf db/work/"$PKG_NAME"
