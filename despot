#!/bin/sh

DESPOT_VERSION="trunk:2022-07-11"

die() {
  case "$1" in
    0) echo "error: package already installed"; exit ;;
    1) echo "error: package not installed"; exit ;;
    2) echo "error: missing dependency $2"; exit ;;
    3) echo "error: no argument given"; exit ;;
    99) exit ;;
  esac
}

test $1 || die 3
case "$1" in
  "version" | "v") echo "despot ${DESPOT_VERSION}"; die 99 ;;
  "help" | "h") cat << EOF
./despot [cmd]

commands:
help            | you're here now
install [pkg]   | install a package
uninstall [pkg] | uninstall a package
version         | show current version
EOF
    die 99 ;;
esac

PKG_LOCK="$1"
PKG_NAME="$2"
. db/repo/$PKG_NAME.dbuild

case "$PKG_LOCK" in
  install) package_install ;;
  uninstall) package_uninstall ;;
esac

unset \
  PKG_TITLE \
  PKG_AUTHOR \
  PKG_VERSION \
  package_remove \
  sources_verify \
  package_install \

cd ../../..
rm -rf db/work/"$PKG_NAME"
