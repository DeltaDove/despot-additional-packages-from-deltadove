#!/bin/sh

DESPOT_VERSION="radioactive::2022-07-11"

die() {
  case "$1" in
    0) echo "package already installed"; exit; ;;
    1) echo "package not installed"; exit; ;;
    2) echo "missing dependency $2"; exit ;;
    3) exit; ;;
  esac
}

case "$1" in
  "version" | "v")
    echo "despot ${DESPOT_VERSION}"
    die 3 
    ;;
  "help" | "h")
    cat << EOF
./despot [cmd]

commands:
help            | you're here now
install [pkg]   | install a package
uninstall [pkg] | uninstall a package
version         | show current version
EOF
    die 3
    ;;
esac

PKG_LOCK="$1"
PKG_NAME="$2"
. db/repo/$PKG_NAME.dbuild

case "$PKG_LOCK" in
  install) package_install ;;
  uninstall) package_uninstall ;;
esac

unset \
  PKG_TITLE \
  PKG_AUTHOR \
  PKG_VERSION \
  package_remove \
  sources_verify \
  package_install \

cd ../../..
rm -rf db/work/"$PKG_NAME"
